import streamlit as st
import random

# ==========================================
# 1. çµ‚æ¥µé¡Œåº«è³‡æ–™åº« (ç«åŠ›å…¨é–‹ç‰ˆ v6.0)
# æ•´åˆ Ch7-Ch16 æ‰€æœ‰è‡ªæˆ‘è©•é‡ã€é—œéµè©èˆ‡å­¸ç¿’ç›®æ¨™
# ==========================================
QUESTION_DB = {
    "(114ä¸Š)å€‹äººè¡ŒéŠ·èˆ‡å½¢è±¡ç®¡ç†": [
        # --- [Ch10 è‡ªæˆ‘èˆ‡å½¢è±¡åˆ†æ - æ·±åº¦é¡Œ] ---
        {
            "q": "(Ch10) é—œæ–¼æ­¸å› ç†è«–ï¼Œç•¶è¡Œç‚ºå…·æœ‰ã€ä½å€è¾¨æ€§ã€(å°ä»»ä½•äº‹éƒ½é€™æ¨£) ä¸”ã€ä½ä¸€è‡´æ€§ã€(åˆ¥äººä¸é€™æ¨£) æ™‚ï¼Œæˆ‘å€‘å‚¾å‘åšä½•ç¨®æ­¸å› ï¼Ÿ",
            "options": ["å…§åœ¨æ­¸å›  (å€‹äººç‰¹è³ª)", "å¤–åœ¨æ­¸å›  (æƒ…å¢ƒ)", "é‹æ°£æ­¸å› ", "ç„¡æ³•åˆ¤æ–·"],
            "ans": 0,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "å‡±åˆ©(Kelley)ç†è«–ï¼šä½å€è¾¨æ€§+ä½ä¸€è‡´æ€§+é«˜æ†å¸¸æ€§ = å…§åœ¨æ­¸å› ã€‚"
        },
        {
            "q": "(Ch10) è‡ªæˆ‘ç›£æ§ (Self-monitoring) åˆ†æ•¸è¼ƒã€ä½ã€çš„äººï¼Œé€šå¸¸å…·æœ‰ä»€éº¼ç‰¹å¾µï¼Ÿ",
            "options": ["åƒè®Šè‰²é¾ä¸€æ¨£é©æ‡‰ç’°å¢ƒ", "è¡Œç‚ºå—å…§åœ¨ç‹€æ…‹èˆ‡åŸå‰‡æŒ‡å¼•ï¼Œè¼ƒä¸éš¨æ³¢é€æµ", "éå¸¸åœ¨æ„åˆ¥äººçš„çœ¼å…‰", "å®¹æ˜“å› ç’°å¢ƒæ”¹è®Šç«‹å ´"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "ä½è‡ªæˆ‘ç›£æ§è€…å‚¾å‘è¡¨ç¾çœŸå¯¦çš„è‡ªå·±ï¼Œè¡Œç‚ºä¸€è‡´æ€§é«˜ï¼Œä¸æ˜“å—æƒ…å¢ƒå½±éŸ¿ã€‚"
        },
        {
            "q": "(Ch10) åœ¨äººæ ¼ç‰¹è³ªèˆ‡å½¢è±¡çš„é—œä¿‚ä¸­ï¼Œã€æ¬Šè¡“ä¸»ç¾©ã€(Machiavellianism) ç‰¹è³ªå¼·çš„äººå‚¾å‘ï¼Ÿ",
            "options": ["æƒ…æ„Ÿè±å¯Œä¸”å…·åŒç†å¿ƒ", "å¯¦ç”¨ä¸»ç¾©ï¼Œèªç‚ºçµæœå¯ä»¥åˆç†åŒ–æ‰‹æ®µ", "éå¸¸é‡è¦–é“å¾·è¦ç¯„", "å®¹æ˜“ç›¸ä¿¡ä»–äºº"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "æ¬Šè¡“ä¸»ç¾©è€…é€šå¸¸ä¿æŒæƒ…æ„Ÿè·é›¢ï¼Œç›¸ä¿¡ã€ç‚ºé”ç›®çš„ä¸æ“‡æ‰‹æ®µã€ã€‚"
        },

        # --- [Ch11 å…§åœ¨æå‡ - æƒ…ç·’èˆ‡å­¸ç¿’] ---
        {
            "q": "(Ch11) é—œæ–¼è·å ´ä¸­çš„ã€æƒ…ç·’å‹å‹™ã€(Emotional Labor)ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ(å¤šé¸)",
            "options": ["æ˜¯æŒ‡å“¡å·¥éœ€è¡¨ç¾å‡ºçµ„ç¹”è¦æ±‚çš„æƒ…ç·’", "æ·±å±¤æ¼”å‡º(Deep Acting)æ˜¯è©¦åœ–å¾å…§å¿ƒæ”¹è®Šæ„Ÿå—", "è¡¨å±¤æ¼”å‡º(Surface Acting)åªæ˜¯æˆ´ä¸Šé¢å…·", "æƒ…ç·’å‹å‹™å®Œå…¨ä¸æœƒé€ æˆå£“åŠ›"],
            "ans": [0, 1, 2],
            "diff": "ä¸­ç­‰",
            "type": "å¤šé¸",
            "expl": "æƒ…ç·’å‹å‹™æ˜¯æœå‹™æ¥­å¸¸è¦‹å£“åŠ›æºï¼›æ·±å±¤èˆ‡è¡¨å±¤æ¼”å‡ºæ˜¯å…©ç¨®ä¸»è¦èª¿ç¯€ç­–ç•¥ã€‚"
        },
        {
            "q": "(Ch11) æƒ³è¦æå‡å…§åœ¨å½¢è±¡ï¼Œã€è‡ªæˆ‘å­¸ç¿’ã€çš„æ–¹æ³•åŒ…å«å“ªäº›ï¼Ÿ(å¤šé¸)",
            "options": ["é–±è®€å°ˆæ¥­æ›¸ç±", "è§€å¯Ÿæ¨¡ä»¿å…¸ç¯„äººç‰©(Role Model)", "åƒåŠ æ•™è‚²è¨“ç·´", "åæ€èˆ‡æª¢è¨"],
            "ans": [0, 1, 2, 3],
            "diff": "ç°¡å–®",
            "type": "å¤šé¸"
        },

        # --- [Ch12 å¤–åœ¨æ”¹è®Š - å½¢è±¡æˆ°ç•¥] ---
        {
            "q": "(Ch12) æ ¹æ“šèª²æœ¬è‡ªæˆ‘è©•é‡ï¼Œã€å£é ­ç¦ªã€(å¦‚ï¼šç„¶å¾Œã€é‚£å€‹) å¯èƒ½æœƒå¸¶ä¾†ä»€éº¼ä¸è‰¯å¾Œæœï¼Ÿ",
            "options": ["å¢åŠ èªªè©±çš„ç¯€å¥æ„Ÿ", "å±•ç¾å€‹äººç‰¹è‰²", "å¹²æ“¾è¨Šæ¯å‚³éï¼Œçµ¦äººæº–å‚™ä¸å‘¨æˆ–ç¼ºä¹è‡ªä¿¡çš„å°è±¡", "è®“è½çœ¾è¦ºå¾—è¦ªåˆ‡"],
            "ans": 2,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },
        {
            "q": "(Ch12) åœ¨éèªè¨€æºé€šä¸­ï¼Œé—œæ–¼ã€è·é›¢ã€(Proxemics) çš„é‹ç”¨ï¼Œã€ç¤¾äº¤è·é›¢ã€é€šå¸¸æ˜¯æŒ‡ï¼Ÿ",
            "options": ["0 ~ 45 å…¬åˆ† (è¦ªå¯†é—œä¿‚)", "45 ~ 120 å…¬åˆ† (æœ‹å‹)", "120 ~ 360 å…¬åˆ† (å•†å‹™/è¾¦å…¬)", "360 å…¬åˆ†ä»¥ä¸Š (æ¼”è¬›)"],
            "ans": 2,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "å•†å‹™äº’å‹•é€šå¸¸ç¶­æŒåœ¨ç¤¾äº¤è·é›¢ (1.2m - 3.6m)ï¼Œæ—¢ä¸ç–é›¢ä¹Ÿä¸ä¾µçŠ¯éš±ç§ã€‚"
        },
        
        # --- [Ch13 è¡çªèˆ‡åˆä½œ - é€²éšé¡Œ] ---
        {
            "q": "(Ch13) è™•ç†è¡çªçš„ã€é †æ‡‰ã€(Accommodating) ç­–ç•¥ï¼Œå…¶ç‰¹å¾µç‚ºä½•ï¼Ÿ",
            "options": ["é«˜è‡ªæˆ‘é—œæ³¨ï¼Œä½ä»–äººé—œæ³¨", "ä½è‡ªæˆ‘é—œæ³¨ï¼Œé«˜ä»–äººé—œæ³¨ (çŠ§ç‰²å°æˆ‘)", "ä½è‡ªæˆ‘é—œæ³¨ï¼Œä½ä»–äººé—œæ³¨", "é«˜è‡ªæˆ‘é—œæ³¨ï¼Œé«˜ä»–äººé—œæ³¨"],
            "ans": 1,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "é †æ‡‰æ˜¯ç‚ºäº†ç¶­æŒé—œä¿‚è€ŒçŠ§ç‰²è‡ªå·±çš„åˆ©ç›Šï¼Œå±¬æ–¼ã€è¼¸-è´ã€ç­–ç•¥ã€‚"
        },
        {
            "q": "(Ch13) ä¸‹åˆ—ä½•è€…æ˜¯ã€ç ´å£æ€§è¡çªã€çš„ç‰¹å¾µï¼Ÿ",
            "options": ["å•é¡Œè¢«å…¬é–‹è¨è«–", "ç„¦é»é›†ä¸­åœ¨ã€äººã€è€Œéã€äº‹ã€(äººèº«æ”»æ“Š)", "æ¿€ç™¼æ–°å‰µæ„", "é‡æ¸…é›™æ–¹ç«‹å ´"],
            "ans": 1,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        },

        # --- [Ch14 è¦åŠƒèˆ‡å»ºç«‹ - æµç¨‹é¡Œ] ---
        {
            "q": "(Ch14) å€‹äººè¡ŒéŠ·è¦åŠƒæµç¨‹çš„æ­£ç¢ºé †åºç‚ºä½•ï¼Ÿ",
            "options": ["è‡ªæˆ‘åˆ†æâ†’ç›®æ¨™è¨­å®šâ†’ç­–ç•¥ç™¼å±•â†’åŸ·è¡Œèˆ‡æ§åˆ¶", "åŸ·è¡Œâ†’è¨­å®šç›®æ¨™â†’è‡ªæˆ‘åˆ†æ", "è²·è¡£æœâ†’å°åç‰‡â†’ç™¼å‚³å–®", "ç­–ç•¥ç™¼å±•â†’è‡ªæˆ‘åˆ†æâ†’ç›®æ¨™è¨­å®š"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "æ¨™æº–æµç¨‹ï¼šåˆ†æ(SWOT) -> è¨­å®šç›®æ¨™ -> åˆ¶å®šç­–ç•¥(STP) -> åŸ·è¡Œèˆ‡è©•ä¼°ã€‚"
        },
        {
            "q": "(Ch14) åœ¨å€‹äººåƒ¹å€¼åˆ†æä¸­ï¼Œã€æ“æœ‰å»£å¤§çš„äººè„ˆç¶²çµ¡ã€å±¬æ–¼ SWOT ä¸­çš„å“ªä¸€é …ï¼Ÿ",
            "options": ["S (å„ªå‹¢) - å…§éƒ¨è³‡æº", "W (åŠ£å‹¢)", "O (æ©Ÿæœƒ)", "T (å¨è„…)"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "äººè„ˆæ˜¯å€‹äººæ“æœ‰çš„è³‡æºï¼Œå±¬æ–¼å…§éƒ¨å„ªå‹¢ã€‚"
        },

        # --- [Ch15 ç­–ç•¥èˆ‡é‹ç”¨ - å®šä½é¡Œ] ---
        {
            "q": "(Ch15) é—œæ–¼å€‹äººå“ç‰Œçš„ã€å®šä½ã€(Positioning)ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…éŒ¯èª¤ï¼Ÿ",
            "options": ["å®šä½æ˜¯ç‚ºäº†åœ¨ç›®æ¨™å°è±¡å¿ƒä¸­å»ºç«‹ç¨ç‰¹ä½ç½®", "å®šä½éœ€è¦é•·æœŸä¸€è‡´çš„å‚³é”", "å®šä½æ‡‰è©²åŒ…å±±åŒ…æµ·ï¼Œä»€éº¼éƒ½åš", "å®šä½æ‡‰åŸºæ–¼è‡ªèº«çš„å„ªå‹¢"],
            "ans": 2,
            "diff": "ç°¡å–®",
            "type": "å–®é¸",
            "expl": "å®šä½å¼·èª¿ã€èšç„¦ã€èˆ‡ã€å–æ¨ã€ï¼Œä»€éº¼éƒ½åšç­‰æ–¼æ²’æœ‰å®šä½ã€‚"
        },
        {
            "q": "(Ch15) è‹¥æ‚¨æƒ³å»ºç«‹ã€å°ˆæ¥­ã€çš„å½¢è±¡ï¼Œåœ¨ç¤¾ç¾¤åª’é«”ä¸Šæ‡‰é¿å…å“ªç¨®è¡Œç‚ºï¼Ÿ",
            "options": ["åˆ†äº«æ¥­ç•Œæœ€æ–°è¶¨å‹¢", "ç™¼è¡¨å°å°ˆæ¥­è­°é¡Œçš„è¦‹è§£", "é »ç¹æŠ±æ€¨å·¥ä½œèˆ‡æƒ…ç·’æ€§è¬¾ç½µ", "å±•ç¾æŒçºŒå­¸ç¿’çš„æˆæœ"],
            "ans": 2,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        },

        # --- [Ch16 ç™¼æ®èˆ‡å¡«å¯« - æ‡‰ç”¨é¡Œ] ---
        {
            "q": "(Ch16) ã€å–¬å“ˆé‡Œçª—ã€ä¸­ï¼Œé€éã€å›é¥‹ã€(Feedback) å¯ä»¥ç¸®å°å“ªä¸€å€‹å€åŸŸï¼Ÿ",
            "options": ["é–‹æ”¾å€", "ç›²ç›®å€ (Blind Spot)", "éš±è—å€", "æœªçŸ¥å€"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "è«‹æ±‚ä»–äººçµ¦äºˆå›é¥‹ï¼Œèƒ½è®“è‡ªå·±çœ‹åˆ°åŸæœ¬çœ‹ä¸è¦‹çš„ç›²é»ï¼Œé€²è€Œç¸®å°ç›²ç›®å€ã€‚"
        },
        {
            "q": "(Ch16) é€éã€è‡ªæˆ‘æ­éœ²ã€(Self-disclosure) å¯ä»¥ç¸®å°å“ªä¸€å€‹å€åŸŸï¼Œæ“´å¤§é–‹æ”¾å€ï¼Ÿ",
            "options": ["ç›²ç›®å€", "éš±è—å€ (Hidden Area)", "æœªçŸ¥å€", "é–‹æ”¾å€"],
            "ans": 1,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "ä¸»å‹•åˆ†äº«è‡ªå·±çš„æƒ³æ³•èˆ‡æ„Ÿå—(æ­éœ²)ï¼Œèƒ½ç¸®å°éš±è—å€ã€‚"
        }
    ],

    "(114ä¸Š)æœå‹™æ¥­ç¶“ç‡Ÿç®¡ç†": [
        # --- [Ch7 è¡ŒéŠ·ç®¡ç† - ä¾†è‡ªèª²æœ¬è‡ªæˆ‘è©•é‡] ---
        {
            "q": "(Ch7) ä¸‹åˆ—ä½•è€…ä¸å±¬æ–¼å‚³çµ±è¡ŒéŠ· 4Pï¼Ÿ",
            "options": ["ç”¢å“ (Product)", "åƒ¹æ ¼ (Price)", "ç ”ç™¼ (R&D)", "ä¿ƒéŠ· (Promotion)"],
            "ans": 2,
            "diff": "ç°¡å–®",
            "type": "å–®é¸",
            "expl": "4P æ˜¯ Product, Price, Place, Promotionã€‚ç ”ç™¼ä¸åœ¨æ­¤åˆ—ã€‚"
        },
        {
            "q": "(Ch7) å» å•†ç‚ºåšå¥½å¸‚å ´å€éš”ï¼Œå¿…é ˆå…ˆé€²è¡Œï¼Ÿ",
            "options": ["å¸‚å ´èª¿æŸ¥", "ç”¢å“ç ”ç™¼", "äººæ‰å‹Ÿé›†", "è²¡å‹™èª¿åº¦"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "å…ˆæœ‰èª¿æŸ¥æ•¸æ“šï¼Œæ‰èƒ½ä¾æ“šè®Šæ•¸é€²è¡Œæœ‰æ•ˆçš„å€éš”ã€‚"
        },
        {
            "q": "(Ch7) ä¸‹åˆ—ä½•è€…ä¸å±¬æ–¼æ¶ˆè²»è€…å¸‚å ´å€éš”çš„ã€ç‰¹å¾µè®Šæ•¸ã€ï¼Ÿ",
            "options": ["åœ°ç†è®Šæ•¸", "äººå£è®Šæ•¸", "è¡Œç‚ºè®Šæ•¸", "å…¬å¸æ–‡åŒ–è®Šæ•¸"],
            "ans": 3,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "å…¬å¸æ–‡åŒ–å±¬æ–¼çµ„ç¹”å¸‚å ´(B2B)çš„è®Šæ•¸ï¼Œè€Œéæ¶ˆè²»è€…å¸‚å ´ã€‚"
        },
        {
            "q": "(Ch7) æœå‹™å“è³ªç¼ºå£æ¨¡å‹ä¸­ï¼ŒGAP 1 (çŸ¥è­˜ç¼ºå£) ç”¢ç”Ÿçš„ä¸»è¦åŸå› æ˜¯ï¼Ÿ",
            "options": ["ç®¡ç†éšå±¤ä¸äº†è§£é¡§å®¢çš„æœŸæœ›", "æœå‹™æ¨™æº–è¨‚å®šä¸ç•¶", "å“¡å·¥æœªæŒ‰æ¨™æº–åŸ·è¡Œ", "éåº¦æ‰¿è«¾"],
            "ans": 0,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "Gap 1 æ˜¯ã€é¡§å®¢æœŸæœ›ã€èˆ‡ã€ç®¡ç†è€…èªçŸ¥ã€ä¹‹é–“çš„è½å·®ã€‚"
        },

        # --- [Ch8 æœå‹™å‰µæ–° - é—œéµè©å»¶ä¼¸] ---
        {
            "q": "(Ch8) ä¾æ“šæœå‹™å°ã€å¸‚å ´ã€èˆ‡ã€ä¼æ¥­ã€çš„æ–°ç©ç¨‹åº¦ï¼Œå‰µæ–°å¯åˆ†ç‚ºå…­é¡ã€‚å…¶ä¸­é¢¨éšªæœ€é«˜ã€å½±éŸ¿æœ€å¤§çš„æ˜¯ï¼Ÿ",
            "options": ["å…¨æ–°å‰µæ–° (New-to-the-world)", "æ–°ç”¢å“ç·š", "ç”¢å“ç·šå»¶ä¼¸", "é¢¨æ ¼æ”¹è®Š"],
            "ans": 0,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "å…¨æ–°å‰µæ–°æ˜¯å‰µé€ å‰æ‰€æœªæœ‰çš„å¸‚å ´ï¼Œé¢¨éšªèˆ‡å ±é…¬çš†æœ€é«˜ã€‚"
        },
        {
            "q": "(Ch8) æœå‹™å‰µæ–°çš„é©…å‹•åŠ›é‡ï¼Œè‹¥æ˜¯ä¾†è‡ªæ–¼ã€ç¬¬ä¸€ç·šå“¡å·¥åœ¨æœå‹™éç¨‹ä¸­ç™¼ç¾æ–°æ–¹æ³•ã€ï¼Œå±¬æ–¼ï¼Ÿ",
            "options": ["ä¾›æ‡‰å•†ä¸»å°", "é¡§å®¢ä¸»å°", "å…§éƒ¨å‰µæ–°/ç‰¹å®šæœå‹™éƒ¨é–€", "æ”¿åºœæ”¿ç­–"],
            "ans": 2,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },
        {
            "q": "(Ch8) æœå‹™è—åœ– (Service Blueprint) åœ¨å‰µæ–°ä¸­çš„ä¸»è¦åŠŸèƒ½ç‚ºä½•ï¼Ÿ",
            "options": ["è¨ˆç®—è²¡å‹™æˆæœ¬", "å¯è¦–åŒ–æœå‹™æµç¨‹ï¼Œæ‰¾å‡ºæ½›åœ¨å¤±æ•—é»", "è¨­è¨ˆå•†æ¨™", "æ‹›å‹Ÿå“¡å·¥"],
            "ans": 1,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },

        # --- [Ch9 é¡§å®¢é—œä¿‚ç®¡ç† - æ·±åº¦é¡Œ] ---
        {
            "q": "(Ch9) é—œæ–¼ã€é¡§å®¢çµ‚èº«åƒ¹å€¼ã€(CLV)ï¼Œä¸‹åˆ—å…¬å¼æ¦‚å¿µä½•è€…æ­£ç¢ºï¼Ÿ",
            "options": ["é¡§å®¢å–®æ¬¡æ¶ˆè²»é‡‘é¡", "é¡§å®¢æœªä¾†ç‰¹å®šæœŸé–“å…§è²¢ç»çš„æ·¨åˆ©æŠ˜ç¾å€¼ç¸½å’Œ", "é¡§å®¢çš„å¹´é½¡", "é¡§å®¢æ»¿æ„åº¦åˆ†æ•¸"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "CLV è€ƒæ…®äº†é¡§å®¢ç¶­æŒç‡ã€è²¢ç»åˆ©æ½¤èˆ‡æŠ˜ç¾ç‡ã€‚"
        },
        {
            "q": "(Ch9) CRM èˆ‡ SCRM (ç¤¾ç¾¤ CRM) çš„æœ€å¤§å·®ç•°åœ¨æ–¼ï¼Ÿ",
            "options": ["SCRM å¼·èª¿é¡§å®¢åƒèˆ‡ã€é›™å‘äº’å‹•èˆ‡å…§å®¹å‰µé€ ", "CRM æ¯”è¼ƒè²´", "SCRM ä¸éœ€è¦é›»è…¦", "å…©è€…å®Œå…¨ä¸€æ¨£"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "SCRM çµåˆäº† Social Mediaï¼Œé¡§å®¢å¾è¢«å‹•æ¥æ”¶è€…è½‰ç‚ºä¸»å‹•åƒèˆ‡è€…ã€‚"
        },
        {
            "q": "(Ch9) å¯¦æ–½ CRM å°ä¼æ¥­å¸¶ä¾†çš„ç«¶çˆ­å„ªå‹¢åŒ…å«ï¼Ÿ(å¤šé¸)",
            "options": ["æå‡é¡§å®¢æ»¿æ„åº¦èˆ‡å¿ èª åº¦", "é€²è¡Œç²¾æº–è¡ŒéŠ·ï¼Œé™ä½æˆæœ¬", "æŒ–æ˜é«˜åƒ¹å€¼é¡§å®¢", "å¯ä»¥å®Œå…¨ä¸ç†æœƒæ–°å®¢æˆ¶"],
            "ans": [0, 1, 2],
            "diff": "ä¸­ç­‰",
            "type": "å¤šé¸"
        },

        # --- [Ch10 ç¸¾æ•ˆè©•ä¼° - èª²æœ¬é—œéµè©] ---
        {
            "q": "(Ch10) è²¡å‹™æŒ‡æ¨™ä¸­ï¼Œè¡¡é‡ã€è³‡ç”¢åˆ©ç”¨æ•ˆç‡ã€çš„æ˜¯ï¼Ÿ",
            "options": ["ROA (è³‡ç”¢å ±é…¬ç‡)", "ROE (è‚¡æ±æ¬Šç›Šå ±é…¬ç‡)", "EPS (æ¯è‚¡ç›ˆé¤˜)", "DFL (è²¡å‹™æ§“æ¡¿)"],
            "ans": 0,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "ROA = æ·¨åˆ© / ç¸½è³‡ç”¢ï¼Œåæ˜ å…¬å¸åˆ©ç”¨è³‡ç”¢å‰µé€ ç²åˆ©çš„èƒ½åŠ›ã€‚"
        },
        {
            "q": "(Ch10) å¹³è¡¡è¨ˆåˆ†å¡ (BSC) é™¤äº†è²¡å‹™æ§‹é¢å¤–ï¼Œé‚„åŒ…å«å“ªä¸‰å€‹æ§‹é¢ï¼Ÿ(å¤šé¸)",
            "options": ["é¡§å®¢æ§‹é¢", "å…§éƒ¨æµç¨‹æ§‹é¢", "å­¸ç¿’èˆ‡æˆé•·æ§‹é¢", "ç’°å¢ƒä¿è­·æ§‹é¢"],
            "ans": [0, 1, 2],
            "diff": "å›°é›£",
            "type": "å¤šé¸",
            "expl": "BSC å››å¤§æ§‹é¢ï¼šè²¡å‹™ã€é¡§å®¢ã€å…§éƒ¨æµç¨‹ã€å­¸ç¿’æˆé•·ã€‚"
        },
        {
            "q": "(Ch10) æœé‚¦åˆ†ææ³• (DuPont Analysis) å°‡ ROE åˆ†è§£ç‚ºå“ªä¸‰éƒ¨åˆ†ï¼Ÿ(å¤šé¸)",
            "options": ["æ·¨åˆ©ç‡ (ç²åˆ©èƒ½åŠ›)", "è³‡ç”¢å‘¨è½‰ç‡ (ç®¡ç†æ•ˆç‡)", "æ¬Šç›Šä¹˜æ•¸ (è²¡å‹™æ§“æ¡¿)", "è‚¡åƒ¹"],
            "ans": [0, 1, 2],
            "diff": "å›°é›£",
            "type": "å¤šé¸",
            "expl": "ROE = æ·¨åˆ©ç‡ Ã— è³‡ç”¢å‘¨è½‰ç‡ Ã— æ¬Šç›Šä¹˜æ•¸ã€‚"
        },

        # --- [Ch11 å°ç£ç”¢æ¥­ç¾æ³ - æ•¸æ“šè¶¨å‹¢] ---
        {
            "q": "(Ch11) æ ¹æ“šè¡Œæ”¿é™¢ä¸»è¨ˆè™•åˆ†é¡ï¼Œæˆ‘åœ‹æœå‹™æ¥­ä¸»è¦åŒ…æ‹¬å¹¾å€‹å¤§é …ï¼Ÿ",
            "options": ["5å€‹", "10å€‹", "13å€‹", "20å€‹"],
            "ans": 2,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "èª²æœ¬è‡ªæˆ‘è©•é‡ç¬¬ä¸€é¡ŒæåŠï¼šåŒ…æ‹¬æ‰¹ç™¼é›¶å”®ã€é‡‘èä¿éšªç­‰13å¤§é …ã€‚"
        },
        {
            "q": "(Ch11) 2021å¹´æˆ‘åœ‹æœå‹™æ¥­å°±æ¥­äººå£èˆ‡ç”¢å€¼ä½”æ¯”æœ€é«˜çš„ç´°é …ç”¢æ¥­é€šå¸¸æ˜¯ï¼Ÿ",
            "options": ["æ‰¹ç™¼åŠé›¶å”®æ¥­", "é‡‘èåŠä¿éšªæ¥­", "é‹è¼¸åŠå€‰å„²æ¥­", "æ•™è‚²æ¥­"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "æ‰¹ç™¼é›¶å”®æ¥­é€šå¸¸æ˜¯æœå‹™æ¥­ä¸­å°±æ¥­äººå£èˆ‡å®¶æ•¸æœ€å¤šçš„ã€‚"
        },
        {
            "q": "(Ch11) ä¸‹åˆ—ä½•è€…æ˜¯è¿‘å¹´æ”¿åºœæ¨å‹•ã€æ™ºæ…§å°ç£ã€è¨ˆç•«åœ¨æœå‹™æ¥­çš„é‡é»ï¼Ÿ",
            "options": ["è¡Œå‹•æ”¯ä»˜æ™®åŠ", "O2O è™›å¯¦æ•´åˆ", "å¤§æ•¸æ“šåˆ†ææ‡‰ç”¨", "ä»¥ä¸Šçš†æ˜¯"],
            "ans": 3,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        },

        # --- [Ch12 ç™¼å±•è¶¨å‹¢ - é—œéµè©] ---
        {
            "q": "(Ch12) é—œæ–¼ ESG æŒ‡æ¨™ï¼Œã€Gã€ä»£è¡¨çš„æ˜¯ï¼Ÿ",
            "options": ["Green (ç¶ è‰²)", "Governance (å…¬å¸æ²»ç†)", "Global (å…¨çƒåŒ–)", "Goal (ç›®æ¨™)"],
            "ans": 1,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "E=Environment, S=Social, G=Governanceã€‚"
        },
        {
            "q": "(Ch12) ã€éåŒè³ªåŒ–ä»£å¹£ã€(NFT) çš„ç‰¹æ€§ç‚ºä½•ï¼Ÿ",
            "options": ["æ¯å€‹ä»£å¹£éƒ½æ˜¯ç¨ä¸€ç„¡äºŒï¼Œä¸å¯æ›¿ä»£", "åƒæ¯”ç‰¹å¹£ä¸€æ¨£å¯ä»¥äº’ç›¸æ›¿æ›", "æ˜¯å¯¦é«”è²¨å¹£", "åªèƒ½ç”¨ä¾†è²·éŠæˆ²å¯¶ç‰©"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸",
            "expl": "NFT åˆ©ç”¨å€å¡ŠéˆæŠ€è¡“æ¨™è¨˜æ•¸ä½è³‡ç”¢çš„æ‰€æœ‰æ¬Šï¼Œå…·å”¯ä¸€æ€§ã€‚"
        },
        {
            "q": "(Ch12) é—œæ–¼å…ƒå®‡å®™ (Metaverse) çš„ç™¼å±•ï¼Œä¸‹åˆ—å“ªå€‹æ¦‚å¿µæ˜¯å…¶æ ¸å¿ƒè¦ç´ ï¼Ÿ(å¤šé¸)",
            "options": ["æ²‰æµ¸å¼é«”é©— (VR/AR)", "è™›æ“¬èº«åˆ† (Avatar)", "å»ä¸­å¿ƒåŒ–ç¶“æ¿Ÿç³»çµ±", "åƒ…é™æ–¼æ–‡å­—äº¤æµ"],
            "ans": [0, 1, 2],
            "diff": "å›°é›£",
            "type": "å¤šé¸"
        },
        {
            "q": "(Ch12) O2O (Online to Offline) å•†æ¥­æ¨¡å¼æ˜¯æŒ‡ï¼Ÿ",
            "options": ["ç·šä¸Šè³¼è²·ï¼Œç·šä¸‹é«”é©—/æœå‹™", "åªåœ¨ç·šä¸ŠéŠ·å”®", "åªåœ¨ç·šä¸‹éŠ·å”®", "è€é—†é¢å°é¢éŠ·å”®"],
            "ans": 0,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        }
    ],

    "(114ä¸Š)å®¶åº­ã€ç¤¾å€èˆ‡ç’°å¢ƒ": [
        # --- [ç¶­æŒä¹‹å‰çš„ç²¾é¸é¡Œï¼Œä¸¦å¢åŠ é›£åº¦] ---
        {
            "q": "Bronfenbrenner ç”Ÿæ…‹ç³»çµ±ç†è«–ä¸­ï¼Œé€£çµå…©å€‹å¾®ç³»çµ±(å¦‚å®¶åº­èˆ‡å­¸æ ¡)ä¹‹é–“çš„äº’å‹•é—œä¿‚ï¼Œç¨±ç‚ºï¼Ÿ",
            "options": ["ä¸­ç³»çµ± (Mesosystem)", "å¤–ç³»çµ± (Exosystem)", "å·¨ç³»çµ± (Macrosystem)", "æ™‚é–“ç³»çµ±"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },
        {
            "q": "é—œæ–¼ã€ç¤¾æœƒè³‡æœ¬ã€(Social Capital) çš„è¡¡é‡ï¼Œä¸åŒ…å«ä¸‹åˆ—å“ªä¸€é …ï¼Ÿ",
            "options": ["ä¿¡ä»»", "äº’æƒ è¦ç¯„", "ç¶²çµ¡é—œä¿‚", "å€‹äººéŠ€è¡Œå­˜æ¬¾"],
            "ans": 3,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        },
        {
            "q": "ã€ä»•ç´³åŒ–ã€(Gentrification) å°ç¤¾å€çš„å½±éŸ¿é€šå¸¸ç‚ºä½•ï¼Ÿ",
            "options": ["æˆ¿åƒ¹ä¸‹è·Œ", "ä¸­ç”¢éšç´šé·å…¥ï¼Œå°è‡´åŸä½æ”¶å…¥å±…æ°‘è¢«è¿«é·é›¢", "ç¤¾å€ç’°å¢ƒè®Šé«’äº‚", "æ¯«ç„¡å½±éŸ¿"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "ä»•ç´³åŒ–é›–æ”¹å–„ç’°å¢ƒï¼Œä½†ä¹Ÿå¸¸å¸¶ä¾†ç¤¾æœƒæ’é™¤èˆ‡å±…ä½æ­£ç¾©å•é¡Œã€‚"
        },
        {
            "q": "ä¸‹åˆ—ä½•è€…å±¬æ–¼ã€éç‡Ÿåˆ©çµ„ç¹”ã€(NPO) åœ¨ç¤¾å€ä¸­çš„è§’è‰²ï¼Ÿ(å¤šé¸)",
            "options": ["æä¾›ç¤¾æœƒæœå‹™", "å€¡å°å…¬å…±è­°é¡Œ", "ä¿ƒé€²ç¤¾å€åŸ¹åŠ›", "è¿½æ±‚è‚¡æ±æœ€å¤§åˆ©æ½¤"],
            "ans": [0, 1, 2],
            "diff": "ä¸­ç­‰",
            "type": "å¤šé¸"
        },
        {
            "q": "å®¶åº­è³‡æºç®¡ç†ä¸­ï¼Œã€é‚Šéš›æ•ˆç”¨éæ¸›ã€æ˜¯æŒ‡ï¼Ÿ",
            "options": ["è³‡æºè¶Šå¤šè¶Šå¥½", "éš¨è‘—æ¶ˆè²»é‡å¢åŠ ï¼Œæ¯å¤šä¸€å–®ä½å¸¶ä¾†çš„æ»¿è¶³æ„Ÿé€æ¼¸ä¸‹é™", "éŒ¢è¶Šç”¨è¶Šå°‘", "é«”åŠ›éš¨å¹´ç´€ä¸‹é™"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸"
        }
    ],

    "(114ä¸Š)ç”Ÿæ…‹æ—…éŠ": [
        # --- [ç”Ÿæ…‹æ—…éŠ - æ³•è¦èˆ‡èªè­‰åŠ å¼·ç‰ˆ] ---
        {
            "q": "ç”Ÿæ…‹æ—…éŠçš„ã€æ‰¿è¼‰é‡ã€åŒ…å«å“ªå¹¾å€‹å±¤é¢ï¼Ÿ(å¤šé¸)",
            "options": ["ç”Ÿæ…‹æ‰¿è¼‰é‡ (ç’°å¢ƒæ¥µé™)", "ç¤¾æœƒå¿ƒç†æ‰¿è¼‰é‡ (æ“æ“ æ„Ÿ)", "è¨­æ–½æ‰¿è¼‰é‡ (åœè»Šå ´ç­‰)", "éŠå®¢éŒ¢åŒ…æ‰¿è¼‰é‡"],
            "ans": [0, 1, 2],
            "diff": "å›°é›£",
            "type": "å¤šé¸"
        },
        {
            "q": "ã€é‡Œå±±å€¡è­°ã€(Satoyama Initiative) çš„æ ¸å¿ƒé¡˜æ™¯æ˜¯ï¼Ÿ",
            "options": ["èˆ‡è‡ªç„¶å’Œè«§å…±ç”Ÿ (Living in harmony with nature)", "äººå®šå‹å¤©", "å…¨é¢éƒ½å¸‚åŒ–", "å®Œå…¨å°å±±è‚²æ—"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },
        {
            "q": "é—œæ–¼ã€ä½ç¢³æ—…éŠã€çš„å¯¦è¸ï¼Œä¸‹åˆ—ä½•è€…éŒ¯èª¤ï¼Ÿ",
            "options": ["æ­ä¹˜å¤§çœ¾é‹è¼¸", "æ”œå¸¶ä¸€æ¬¡æ€§ç›¥æ´—ç”¨å“", "é¸è³¼åœ¨åœ°é£Ÿæé¤é£²", "æ¸›å°‘å»¢æ£„ç‰©ç”¢ç”Ÿ"],
            "ans": 1,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        },
        {
            "q": "ç’°å¢ƒè§£èªªçš„ã€Tilden å…­å¤§åŸå‰‡ã€ä¸­ï¼Œå¼·èª¿è§£èªªå¿…é ˆï¼Ÿ",
            "options": ["èˆ‡éŠå®¢çš„ç¶“é©—æˆ–æ€§æ ¼ç›¸é—œè¯", "åªæ˜¯çµ¦äºˆè³‡è¨Š", "æ˜¯ä¸€ç¨®æ•™æ¢å¼çš„æ•™å°", "ä¸éœ€è¦æœ‰çµ„ç¹”çµæ§‹"],
            "ans": 0,
            "diff": "å›°é›£",
            "type": "å–®é¸",
            "expl": "Freeman Tilden èªç‚ºè§£èªªè‹¥ç„¡æ³•èˆ‡éŠå®¢ç¶“é©—é€£çµï¼Œå°±æ˜¯ç„¡æ•ˆçš„ã€‚"
        },
        {
            "q": "IUCN å°ä¿è­·å€çš„åˆ†é¡ä¸­ï¼Œç®¡åˆ¶æœ€åš´æ ¼ã€ä¸»è¦ä¾›ç§‘å­¸ç ”ç©¶ä½¿ç”¨çš„æ˜¯ï¼Ÿ",
            "options": ["Ia åš´æ ¼è‡ªç„¶ä¿ç•™å€", "II åœ‹å®¶å…¬åœ’", "V åœ°æ™¯ä¿è­·å€", "VI è³‡æºæ°¸çºŒåˆ©ç”¨å€"],
            "ans": 0,
            "diff": "å›°é›£",
            "type": "å–®é¸"
        }
    ],
    
    "(114ä¸Š)å©šå§»èˆ‡å®¶äººé—œä¿‚": [
        # --- [ç†è«–æ·±åŒ–é¡Œ] ---
        {
            "q": "æ ¹æ“š Olson çš„ç’°ç‹€æ¨¡å¼ï¼Œå®¶åº­é‹ä½œæœ€ç†æƒ³çš„ç‹€æ…‹æ˜¯ï¼Ÿ",
            "options": ["å¹³è¡¡å‹ (Balanced)", "åƒµåŒ–å‹ (Rigid)", "æ··äº‚å‹ (Chaotic)", "ç³¾çµå‹ (Enmeshed)"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },
        {
            "q": "å®¶åº­å£“åŠ›çš„ã€å †ç–Šæ•ˆæ‡‰ã€(Pile-up) æ˜¯æŒ‡ï¼Ÿ",
            "options": ["å£“åŠ›äº‹ä»¶æ¥è¸µè€Œä¾†ï¼Œå®¶åº­ä¾†ä¸åŠèª¿é©", "è¡£æœå †å¾—å¾ˆé«˜", "éŒ¢è³ºå¾—å¾ˆå¤š", "å®¶äººé«”é‡å¢åŠ "],
            "ans": 0,
            "diff": "ç°¡å–®",
            "type": "å–®é¸"
        },
        {
            "q": "ã€ä»£é–“çŸ›ç›¾ã€(Intergenerational Ambivalence) æ˜¯æŒ‡ï¼Ÿ",
            "options": ["å…©ä»£ä¹‹é–“å®Œå…¨ç„¡æ³•æºé€š", "è¦ªå­ä¹‹é–“åŒæ™‚å­˜åœ¨æƒ…æ„Ÿè¦ªå¯†èˆ‡è§€å¿µè¡çªçš„çŸ›ç›¾æ„Ÿå—", "ç¥–å­«æ„Ÿæƒ…å¾ˆå¥½", "çˆ¶æ¯ä¸ç®¡å°å­©"],
            "ans": 1,
            "diff": "å›°é›£",
            "type": "å–®é¸"
        },
        {
            "q": "é—œæ–¼ã€ç©ºå·¢æœŸã€çš„å©šå§»æ»¿æ„åº¦ï¼Œç ”ç©¶é€šå¸¸å‘ˆç¾ä»€éº¼æ›²ç·šï¼Ÿ",
            "options": ["Uå‹æ›²ç·š (è‚²å…’æœŸä¸‹é™ï¼Œç©ºå·¢æœŸå›å‡)", "å€’Uå‹", "ç›´ç·šä¸‹é™", "ä¸€ç›´éƒ½å¾ˆä½"],
            "ans": 0,
            "diff": "ä¸­ç­‰",
            "type": "å–®é¸"
        },
        {
            "q": "å®¶åº­æš´åŠ›é˜²æ²»æ³•ä¸­ï¼Œæ‰€ä¿è­·çš„ã€å®¶åº­æˆå“¡ã€ç¯„åœï¼ŒåŒ…å«ï¼Ÿ(å¤šé¸)",
            "options": ["é…å¶æˆ–å‰é…å¶", "ç¾æœ‰æˆ–æ›¾æœ‰åŒå±…é—œä¿‚è€…", "ç›´ç³»è¡€è¦ª", "å››è¦ªç­‰å…§æ—ç³»è¡€è¦ª"],
            "ans": [0, 1, 2, 3],
            "diff": "ä¸­ç­‰",
            "type": "å¤šé¸"
        }
    ]
}

# ==========================================
# 2. APP ä»‹é¢é‚è¼¯ (v6.0 ç©©å®šç‰ˆ)
# ==========================================
st.set_page_config(page_title="ç©ºå¤§æœŸæœ«è€ƒè¡åˆº", page_icon="ğŸ“")
st.title("ğŸ“ ç©ºå¤§æœŸæœ«è€ƒè¡åˆºç³»çµ± (v6.0 çµ‚æ¥µç‰ˆ)")

# åˆå§‹åŒ– Session State
if 'exam_finished' not in st.session_state: st.session_state.exam_finished = False
if 'exam_results' not in st.session_state: st.session_state.exam_results = []
if 'quiz_score' not in st.session_state: st.session_state.quiz_score = 0
if 'quiz' not in st.session_state: st.session_state.quiz = []
if 'user_answers' not in st.session_state: st.session_state.user_answers = {}

# å´é‚Šæ¬„è¨­å®š
with st.sidebar:
    st.header("âš™ï¸ è€ƒè©¦è¨­å®š")
    subject = st.selectbox("é¸æ“‡ç§‘ç›®", list(QUESTION_DB.keys()))
    difficulty = st.radio("é¸æ“‡é›£åº¦", ["å…¨éƒ¨", "ç°¡å–®", "ä¸­ç­‰", "å›°é›£"], index=0)
    
    # é¡¯ç¤ºé¡Œåº«æ•¸é‡
    q_count = len(QUESTION_DB[subject])
    st.info(f"ğŸ“š ç›®å‰é¡Œåº«ï¼š{q_count} é¡Œ")
    
    # é‡æ–°é–‹å§‹æŒ‰éˆ•
    if st.button("ğŸ”„ é‡ç½®/é–‹å§‹æ–°æ¸¬é©—", use_container_width=True):
        st.session_state.exam_finished = False
        st.session_state.quiz = []
        st.session_state.exam_results = []
        st.session_state.user_answers = {}
        st.rerun()

# ç¯©é¸é¡Œç›®é‚è¼¯
def get_questions(subj, diff):
    all_q = QUESTION_DB[subj]
    if diff == "å…¨éƒ¨":
        return all_q
    return [q for q in all_q if q['diff'] == diff]

# é¡¯ç¤ºè€ƒå·å€åŸŸ
if not st.session_state.exam_finished:
    # å¦‚æœé‚„æ²’æœ‰é¡Œç›®ï¼Œé€²è¡ŒæŠ½å–
    if not st.session_state.quiz:
        questions = get_questions(subject, difficulty)
        if not questions:
            st.warning("âš ï¸ æ­¤é›£åº¦ä¸‹æ²’æœ‰é¡Œç›®ï¼Œè«‹é¸æ“‡å…¶ä»–é›£åº¦ã€‚")
        else:
            # éš¨æ©Ÿæ‰“äº‚é¡Œç›®é †åºï¼Œé è¨­æŠ½å– 15 é¡Œ (è€ƒé¡Œè®Šå¤šï¼ŒæŠ½å–é‡å¢åŠ )
            st.session_state.quiz = random.sample(questions, min(len(questions), 15))

    # é¡¯ç¤ºé¡Œç›®è¡¨å–®
    if st.session_state.quiz:
        with st.form("exam_form"):
            user_ans_container = {}
            
            for i, q in enumerate(st.session_state.quiz):
                st.markdown(f"#### ç¬¬ {i+1} é¡Œï¼š{q['q']}")
                # é¡¯ç¤ºé›£åº¦èˆ‡é¡Œå‹æ¨™ç±¤
                st.caption(f"é›£åº¦ï¼š{q['diff']} | é¡Œå‹ï¼š{q.get('type', 'å–®é¸')}")
                
                # --- æ ¸å¿ƒé‚è¼¯ï¼šåˆ¤æ–·å–®é¸æˆ–å¤šé¸ ---
                q_type = q.get('type', 'å–®é¸')
                
                if q_type == "å¤šé¸":
                    # å¤šé¸é¡Œä½¿ç”¨ multiselect
                    user_ans_container[i] = st.multiselect(
                        "è«‹é¸æ“‡ç­”æ¡ˆ (å¯è¤‡é¸):",
                        q['options'],
                        key=f"q_{i}"
                    )
                else:
                    # å–®é¸é¡Œä½¿ç”¨ radio
                    user_ans_container[i] = st.radio(
                        "è«‹é¸æ“‡ä¸€å€‹ç­”æ¡ˆ:",
                        q['options'],
                        index=None, # é è¨­ä¸é¸
                        key=f"q_{i}"
                    )
                st.divider()
            
            # äº¤å·æŒ‰éˆ•
            submitted = st.form_submit_button("ğŸ“ äº¤å·è¨ˆåˆ†", use_container_width=True)
            
            if submitted:
                score = 0
                results = []
                
                for i, q in enumerate(st.session_state.quiz):
                    u_ans_text = user_ans_container[i]
                    is_correct = False
                    correct_ans_indices = q['ans']
                    
                    # --- æ ¸å¿ƒé‚è¼¯ï¼šè¨ˆåˆ†èˆ‡æ¯”å° ---
                    if q.get('type') == "å¤šé¸":
                        # å¤šé¸é¡Œè™•ç†
                        if not isinstance(correct_ans_indices, list):
                            correct_ans_indices = [correct_ans_indices]
                            
                        # ç²å–æ­£ç¢ºç­”æ¡ˆçš„æ–‡å­—åˆ—è¡¨
                        correct_ans_texts = [q['options'][idx] for idx in correct_ans_indices]
                        
                        # æ¯”å° (ä½¿ç”¨ set å¿½ç•¥é †åº)
                        if set(u_ans_text) == set(correct_ans_texts):
                            score += 1
                            is_correct = True
                        
                        results.append({
                            "q": q['q'],
                            "user": "ã€".join(u_ans_text) if u_ans_text else "æœªä½œç­”",
                            "correct": "ã€".join(correct_ans_texts),
                            "is_correct": is_correct,
                            "expl": q.get("expl", "å¤šé¸é¡Œéœ€å®Œå…¨ç­”å°æ‰å¾—åˆ†ã€‚")
                        })
                        
                    else:
                        # å–®é¸é¡Œè™•ç†
                        correct_text = q['options'][correct_ans_indices]
                        if u_ans_text == correct_text:
                            score += 1
                            is_correct = True
                            
                        results.append({
                            "q": q['q'],
                            "user": u_ans_text if u_ans_text else "æœªä½œç­”",
                            "correct": correct_text,
                            "is_correct": is_correct,
                            "expl": q.get("expl", "")
                        })

                # å„²å­˜çµæœä¸¦åˆ·æ–°
                st.session_state.quiz_score = score
                st.session_state.exam_results = results
                st.session_state.exam_finished = True
                st.rerun()

# çµæœé¡¯ç¤ºé é¢
else:
    final_score = st.session_state.quiz_score
    total_q = len(st.session_state.quiz)
    
    st.metric("æœ¬æ¬¡å¾—åˆ†", f"{final_score} / {total_q}", delta=f"ç­”å°ç‡ {final_score/total_q:.0%}")
    
    if final_score == total_q:
        st.balloons()
        st.success("å¤ªå¼·äº†ï¼å…¨å°ï¼ ğŸ‰")
    elif final_score >= total_q * 0.6:
        st.info("è¡¨ç¾ä¸éŒ¯ï¼Œç¹¼çºŒä¿æŒï¼ ğŸ‘")
    else:
        st.error("å†æ¥å†å²ï¼Œå¤šè¤‡ç¿’ä¸€ä¸‹å–”ï¼ ğŸ’ª")
        
    st.markdown("### ğŸ” è©³ç´°è§£æ")
    for i, res in enumerate(st.session_state.exam_results):
        with st.expander(f"ç¬¬ {i+1} é¡Œï¼š{'âœ… æ­£ç¢º' if res['is_correct'] else 'âŒ éŒ¯èª¤'}"):
            st.markdown(f"**é¡Œç›®ï¼š** {res['q']}")
            if res['is_correct']:
                st.success(f"**æ‚¨çš„ç­”æ¡ˆï¼š** {res['user']}")
            else:
                st.error(f"**æ‚¨çš„ç­”æ¡ˆï¼š** {res['user']}")
                st.info(f"**æ­£ç¢ºç­”æ¡ˆï¼š** {res['correct']}")
            if res['expl']:
                st.caption(f"ğŸ’¡ è§£æï¼š{res['expl']}")

    if st.button("â†©ï¸ è¿”å›é¦–é  (å†æ¸¬ä¸€æ¬¡)", use_container_width=True):
        st.session_state.exam_finished = False
        st.session_state.quiz = []
        st.session_state.exam_results = []
        st.session_state.user_answers = {}
        st.rerun()
